<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Type piracy · Aqua.jl</title><meta name="title" content="Type piracy · Aqua.jl"/><meta property="og:title" content="Type piracy · Aqua.jl"/><meta property="twitter:title" content="Type piracy · Aqua.jl"/><meta name="description" content="Documentation for Aqua.jl."/><meta property="og:description" content="Documentation for Aqua.jl."/><meta property="twitter:description" content="Documentation for Aqua.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="Aqua.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">Aqua.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Tests</span><ul><li><a class="tocitem" href="../test_all/">Test everything</a></li><li><a class="tocitem" href="../ambiguities/">Ambiguities</a></li><li><a class="tocitem" href="../unbound_args/">Unbound Type Parameters</a></li><li><a class="tocitem" href="../exports/">Undefined exports</a></li><li><a class="tocitem" href="../project_extras/">Project.toml extras</a></li><li><a class="tocitem" href="../stale_deps/">Stale dependencies</a></li><li><a class="tocitem" href="../deps_compat/">Compat entries</a></li><li class="is-active"><a class="tocitem" href>Type piracy</a><ul class="internal"><li><a class="tocitem" href="#Examples"><span>Examples</span></a></li><li><a class="tocitem" href="#test_piracies"><span>Test function</span></a></li></ul></li><li><a class="tocitem" href="../persistent_tasks/">Persistent Tasks</a></li></ul></li><li><a class="tocitem" href="../release-notes/">Release notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tests</a></li><li class="is-active"><a href>Type piracy</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Type piracy</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaTesting/Aqua.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaTesting/Aqua.jl/blob/master/docs/src/piracies.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Type-piracy"><a class="docs-heading-anchor" href="#Type-piracy">Type piracy</a><a id="Type-piracy-1"></a><a class="docs-heading-anchor-permalink" href="#Type-piracy" title="Permalink"></a></h1><p>Type piracy is a term used to describe adding methods to a foreign function with only foreign arguments. This is considered bad practice because it can cause unexpected behavior when the function is called, in particular, it can change the behavior of one of your dependencies depending on if your package is loaded or not. This makes it hard to reason about the behavior of your code, and may introduce bugs that are hard to track down.</p><p>See <a href="https://docs.julialang.org/en/v1/manual/style-guide/#Avoid-type-piracy">Julia documentation</a> for more information about type piracy.</p><h2 id="Examples"><a class="docs-heading-anchor" href="#Examples">Examples</a><a id="Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Examples" title="Permalink"></a></h2><p>Say that <code>PkgA</code> is foreign, and let&#39;s look at the different ways that <code>PkgB</code> extends its function <code>bar</code>.</p><pre><code class="language-julia hljs">module PkgA
    struct C end
    bar(x::C) = 42
    bar(x::Vector) = 43
end

module PkgB 
    import PkgA: bar, C
    struct D end
    bar(x::C) = 1
    bar(xs::D...) = 2
    bar(x::Vector{&lt;:D}) = 3
    bar(x::Vector{D}) = 4 # slightly bad (may cause invalidations)
    bar(x::Union{C,D}) = 5 # slightly bad (a change in PkgA may turn it into piracy)
    #                        (for example changing bar(x::C) = 1 to bar(x::Union{C,Int}) = 1)
end</code></pre><p>The following cases are enumerated by the return values in the example above:</p><ol><li>This is the worst case of type piracy. The value of <code>bar(C())</code> can be either <code>1</code> or <code>42</code> and will depend on whether <code>PkgB</code> is loaded or not.</li><li>This is also a bad case of type piracy. <code>bar()</code> throws a <code>MethodError</code> with only <code>PkgA</code> available, and returns <code>2</code> with <code>PkgB</code> loaded. <code>PkgA</code> may add a method for <code>bar()</code> that takes no arguments in the future, and then this is equivalent to case 1.</li><li>This is a moderately bad case of type piracy. <code>bar(Union{}[])</code> returns <code>3</code> when <code>PkgB</code> is loaded, and <code>43</code> when <code>PkgB</code> is not loaded, although neither of the occurring types are defined in <code>PkgB</code>. This case is not as bad as cases 1 and 2, because it is only about behavior around <code>Union{}</code>, which has no instances.</li><li>Depending on ones understanding of type piracy, this could be considered piracy as well. In particular, this may cause invalidations.</li><li>This is a slightly bad case of type piracy. In the current form, <code>bar(C())</code> returns <code>42</code> as the dispatch on <code>Union{C,D}</code> is less specific. However, a future change in <code>PkgA</code> may change this behavior, e.g. by changing <code>bar(x::C)</code> to <code>bar(x::Union{C,Int})</code> the call <code>bar(C())</code> would become ambiguous.</li></ol><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The test function below currently only checks for cases 1 and 2.</p></div></div><h2 id="test_piracies"><a class="docs-heading-anchor" href="#test_piracies">Test function</a><a id="test_piracies-1"></a><a class="docs-heading-anchor-permalink" href="#test_piracies" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Aqua.test_piracies" href="#Aqua.test_piracies"><code>Aqua.test_piracies</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">test_piracies(m::Module)</code></pre><p>Test that <code>m</code> does not commit type piracies.</p><p><strong>Keyword Arguments</strong></p><ul><li><code>broken::Bool = false</code>: If true, it uses <code>@test_broken</code> instead of <code>@test</code> and shortens the error message.</li><li><code>skip_deprecated::Bool = true</code>: If true, it does not check deprecated methods.</li><li><code>treat_as_own = Union{Function, Type}[]</code>: The types in this container  are considered to be &quot;owned&quot; by the module <code>m</code>. This is useful for  testing packages that deliberately commit some type piracies, e.g. modules adding higher-level functionality to a lightweight C-wrapper, or packages that are extending <code>StatsAPI.jl</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaTesting/Aqua.jl/blob/065f7d78a67a7a93f956263b3054fa5a0efea70f/src/piracies.jl#L202-L216">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../deps_compat/">« Compat entries</a><a class="docs-footer-nextpage" href="../persistent_tasks/">Persistent Tasks »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Thursday 10 October 2024 14:41">Thursday 10 October 2024</span>. Using Julia version 1.11.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
